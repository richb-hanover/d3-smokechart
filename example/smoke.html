<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Small demo for d3-smokechart library" />
    <title>D3-Smokechart demo</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <h3>Using selection.call(obj.chart, args)</h3>
    <div id="smokeTest1"></div>
    <h3>Using obj.line(N) and obj.smokeBands(M)</h3>
    <div id="smokeTest2"></div>
  </body>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="../umd/d3-smokechart.js"></script>
  <script>
    // prettier-ignore
    const smokeData = [
      [164,165,167,184,193,240], [152,155,161,162,170,273], [154,158,158,159,161,163], [166,167,173,174,174,220], [161,162,164,167,167,274],
      [160,162,162,164,171,206], [162,163,163,165,168,194], [160,164,166,168,174,178], [161,169,171,176,177,187], [137,148,159,166,170,171],
      [161,164,165,168,169,170], [163,166,167,169,169,170], [161,161,167,168,179,253], [177,178,179,191,197,299], [149,150,166,168,190,247],
      [123,165,166,181,190,238], [141,147,168,178,178,185], [178,181,182,184,195,218], [166,177,185,196,200,263], [162,164,165,165,168,211],
      [143,145,156,159,161,254], [148,150,150,155,155,219], [149,154,163,164,165,167], [162,165,165,169,215,250], [160,164,167,167,175,186],
      [162,162,164,167,30,77], [28,29,29,31,32,38], [31,31,32,32,33,45], [123,129,134,152,91,93], [133,140,155,160,162,259],
      [154,155,158,159,160,241], [118,125,144,147,150,199], [137,148,149,150,151,177], [151,151,152,153,159,269], [151,151,169,175,176,256],
      [165,168,174,174,175,176], [173,173,173,179,184,276], [170,171,177,177,183,188], [174,175,176,178,178,270], [168,174,177,179,181,259],
      [128,153,162,172,174,191], [160,164,166,167,169,170], [155,156,157,157,162,234], [151,156,157,163,169,173], [165,165,170,178,178,284],
      [161,162,165,166,246,698], [147,148,148,156,160,165], [141,146,148,151,153,154], [158,162,169,170,170,255], [102,118,162,166,168,181],
      [113,126,151,159,248,70], [158,162,162,170,232], [146,159,162,164,165,165], [110,167,171,172,NaN,NaN,NaN], [114,149,161,162,170,197],
      [155,161,166,167,169,247], [161,163,163,167,170,252], [162,165,166,173,178,243], [161,169,175,176,178,181], [165,166,167,171,171,171],
      [163,164,164,166,168,187], [165,167,168,170,172,182], [163,163,166,166,168,179], [172,172,173,175,184,225], [164,166,166,167,174,182],
      [160,161,163,171,172,200], [165,166,166,167,169,263], [170,171,171,173,176,177], [149,157,157,161,165,165], [162,162,163,169,171,255],
      [160,165,166,167,169,170], [167,167,170,171,174,202], [162,163,163,163,168,169], [113,122,140,146,153,157], [162,165,168,168,170,222],
      [165,169,172,174,185,186], [164,164,166,167,172,173], [162,168,168,171,185,185], [1054,115,134,135,167,96], [144,31,33,36,63,74],
      [105,112,170,180,30,33], [31,32,33,35,45,53], [30,31,32,32,32,32], [143,262,32,43,49,95], [30,30,31,32,32,33,NaN],
      [27,30,30,31,31,87], [113,121,127,128,31,73], [111,112,137,138,147,148], [137,144,146,150,154,165], [144,145,149,150,154,216],
      [154,154,158,159,160,189], [158,160,161,162,169,266], [164,165,166,167,170,170], [157,159,160,161,161,192], [156,157,158,158,158,160],
      [154,158,162,175,183,222], [156,156,157,158,165,223], [159,164,167,168,170,171], [160,161,163,168,228], [163,163,164,165,166,169],
      [161,162,163,168,172,187], [160,163,163,166,183,276], [118,126,163,178,186,68], [114,153,158,178,43,63], [122,55,56,85,86,96],
    ]

    const scaleX = d3.scaleLinear([50, 1000])
    const scaleY = d3.scaleLinear([290, 10])

    const smoker = d3.Smokechart({ scaleX, scaleY }).data(smokeData).adjustScaleRange()

    // library's all-in-one example:

    const test1 = d3.select("#smokeTest1").append("svg").attr("width", 1050).attr("height", 300)
    test1.append("g").call(smoker.chart, {
      mode: "smoke",
      bands: 5,
      errorRadius: 10,
      lineWidth: 1,
      bandsColor: "rgba(0,0,0,.075)",
      lineColor: "rgb(0,100,0)",
    })

    // manual step-by-step rendering example with custom bands choice:

    const test2 = d3.select("#smokeTest2").append("svg").attr("width", 1050).attr("height", 300)

    // custom way of adding errors first to create "color background stripes"
    const errors = smoker.countErrors() // array of {errors, count} for each X

    const g = test2.append("g")
    g.selectAll("rect.errorBands")
      .data(errors)
      .enter()
      .append("rect")
      .attr("fill", function (d) {
        return `rgba(255, 0,0,${d.errors / d.count})`
      })
      .attr("x", function (d) {
        return scaleX(d.xPos - 0.5)
      })
      .attr("height", 300)
      .attr("width", function (d) {
        return scaleX(d.xPos + 0.5) - scaleX(d.xPos - 0.5)
      })

    g.selectAll("path.smokeBand")
      .data(
        smoker.smokeBands([
          [0.45, 0.55],
          [0.4, 0.6],
          [0.35, 0.65],
          [0.3, 0.7],
          [0.25, 0.75],
          [0.2, 0.8],
          [0.15, 0.85],
          [0.1, 0.9],
          [0.05, 0.95],
          [0, 1],
        ])
      )
      .enter()
      .append("path")
      .attr("fill", "rgba(30,50,50,.1)")
      .attr("d", d => d)

    g.selectAll("path.midLine")
      .data(smoker.line(0.5))
      .enter()
      .append("path")
      .attr("stroke", "#0099ff")
      .attr("stroke-width", 1)
      .attr("fill", "transparent")
      .attr("d", d => d)
  </script>
</html>
